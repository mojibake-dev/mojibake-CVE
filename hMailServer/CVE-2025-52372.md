# CVE-2025-52372

 **Suggested description:** An issue in hMailServer v.5.8.6 allows a local attacker to obtainsensitive information via the `hmailserver/installation/hMailServerInnoExtension.iss`, and `hMailServer.ini` components.

**VulnerabilityType Other:** CWE-328: Use of Weak Hash

**Vendor of Product:** hMailServer

**Affected Product Code Base:** hMailServer - 5.8.6, 5.6.9-beta

**Affected Component:** `hmailserver/installation/hMailServerInnoExtension.iss`, `hMailServer.ini`

**Attack Type:** Local 

**Impact Information Disclosure:** true

**Attack Vectors:** Attacker must simply take the admin password string and run it against any number of tools designed to crack md5 hashes.

**Reference:** 
- hMailServer Exploit: https://github.com/mojibake-dev/hMailEnum
- Generic Exploit: https://github.com/mojibake-dev/belskysGambit
- Blog Post: https://mojibake.dev/belskys-gambit
- Application: https://github.com/hmailserver/hmailserver

**Discoverer:** Eli Samara

**Detailed Explanation:**

The program installation defaults to md5 hashing for the `AdministratorPassword` in under `[Security]` `hMailServer.INI` at setup.
```pascal
function GetHashedPassword(Param: String) : String;
begin
  Result := GetMD5OfString(g_szAdminPassword);
end;
```
> line 239 of `hmailserver/installation/hMailServerInnoExtension.iss`

This is passed to the code in our test install to `DBSetupQuick.exe` as we are not specifying a DB
```pascal
	  // Add the password as well, so that the administrator doesn't have to type it in again
      //  if he have just entered it. If this is an upgrade, he'll have to enter it again though.
      if (Length(g_szAdminPassword) > 0) then
         szParameters := szParameters + ' password:' + g_szAdminPassword;
		 
      if ((GetCurrentDatabaseType() <> '') or g_bUseInternal) then
      begin
         if (Exec(ExpandConstant('{app}\Bin\DBSetupQuick.exe'), szParameters, '', SW_SHOWNORMAL, ewWaitUntilTerminated, ResultCode) = False) then
            MsgBox(SysErrorMessage(ResultCode), mbError, MB_OK);
      end
      else
      begin
         if (Exec(ExpandConstant('{app}\Bin\DBSetup.exe'), szParameters, '', SW_SHOWNORMAL, ewWaitUntilTerminated, ResultCode) = False) then
            MsgBox(SysErrorMessage(ResultCode), mbError, MB_OK);

      end;
```
> line 646 of `hmailserver/installation/hMailServerInnoExtension.iss`

and is then written to the ini file 
```pascal
Filename: "{app}\Bin\hMailServer.INI"; Section: "Security"; Key: "AdministratorPassword"; String: "{code:GetHashedPassword}"; Flags: createkeyifdoesntexist; Components: server;
```
> line 126 of `hmailserver/installation/Shared.iss`

Additional updates to this password will be more secure by way of stronger hashing. 
```cpp
   IniFileSettings::SetAdministratorPassword(const String &sNewPassword)
   //---------------------------------------------------------------------------()
   // DESCRIPTION:
   // Updates the main hMailServer administration password found in hMailServer.ini
   //---------------------------------------------------------------------------()
   {
      administrator_password_ = HM::Crypt::Instance()->EnCrypt(sNewPassword, HM::Crypt::ETSHA256);

      WriteIniSetting_("Security", "AdministratorPassword", administrator_password_);
   }
```
> line 356 `hmailserver/source/Server/Common/Application/IniFileSettings.cpp`

but the *initial* time the password is set will still be an insecure hash.
